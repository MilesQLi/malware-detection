# combine-av-reports.py
#
# Combine the processed ClamAV and Windows Defender reports, drop duplicates and 
# fill NaN values with "OK".
#
# Inputs : clamav-xxx.csv and defender-xxx.csv
#          row format = [file_name, malware_type]
#
# Outputs: sorted-av-report.csv
#          row format = [file_name, clamav_malware_type, windefender_malware_type] 
#
#          
#
# Author: Derek Chadwick
# Date  : 18/08/2016

import os
from csv import writer
import numpy as np
import pandas as pd
import math
import scipy.misc
import array
import time as tm
import io # this is required as a compatability layer between 2.x and 3.x because 2.x cannot read utf-16 text files.
import re



# TODO: Add command line arguments to specify files to combine.

clammals = pd.read_csv('data/clamav001.csv')
windefmals = pd.read_csv('data/defender001.csv')

allmals = clammals.merge(windefmals, on='filename', how='outer', indicator=True, sort=True)

uniq_allmals = allmals.drop_duplicates(subset='filename', keep='first')

filled_uniq_allmals = uniq_allmals.replace(np.NaN, 'OK')

# Now we have our combined AV results, write to file.
filled_uniq_allmals.to_csv('data/sorted-av-report.csv', index=False)


