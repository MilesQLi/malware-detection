# feature_reduction_pe_asm.py
#
# Read a bunch of PE feature files and use chi-squared tests to remove features
# that are independent of the label.
#
# Feature sets include:
#
# Input : sorted-pe-asm-features.csv
#         row format = [file_name, [list of x86 opcodes], [list of x86 registers]]
#          
#         sorted-pe-header-features.csv
#         row format = [file_name, [keyword list...]]
#
#         sorted-pe-call-graph-features.csv
#         row format = [file_name, [function name list...]]
#
#         sorted-packer-id-features.csv
#         row format = [file_name, packer_name, packer_id, valid_pe, is_packed]]
#
#         sorted-file-id-features.csv
#         row format = [file_name, file_type, file_id]
#
#         sorted-trid-id-features.csv
#         row format = [file_name, file_type, percentage, trid_id]
#
#         sorted-entropy-features.csv
#         row format = [file_name, entropy, file_size]
#
# Output: sorted-pe-asm-features-reduced.csv
#         row format = [file_name, [list of x86 opcodes], [list of x86 registers]]
#
#
#
# Author: Derek Chadwick
# Date  : 30/09/2016
#
# TODO: optimise and many many things

import numpy as np
import scipy as sp
import pandas as pd
import sklearn as skl
import matplotlib.pyplot as plt
from sklearn.feature_selection import SelectKBest, SelectPercentile
from sklearn.feature_selection import chi2
from sklearn.metrics import log_loss, confusion_matrix, accuracy_score
from sklearn.ensemble import RandomForestClassifier, ExtraTreesClassifier
from sklearn.cross_validation import cross_val_score, KFold




def feature_reduction_percent(percentage, train_data_df, train_labels_df):
    # find the top percent variance features.
    fsp = SelectPercentile(chi2, percentage)
    
    X_reduced = fsp.fit_transform(X,y)
    return
    


# Start of Script


sorted_train_data = pd.read_csv('data/sorted-pe-asm-features-vs251.csv')
sorted_labels = pd.read_csv('data/sorted-train-labels-vs251.csv')

X = sorted_train_data.iloc[:,1:]
y = np.array(sorted_train_labels.iloc[:,1])

# End of Script